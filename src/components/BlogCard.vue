<script setup lang="ts">
import { ref, computed, watch } from 'vue';
import Modal from '@/components/Modal.vue';
import { getCommentWord } from '@/utils/comments';

const props = defineProps({
  post: {
    type: Object,
    required: true
  }
});

const emit = defineEmits(['update-comments']);

const isModalOpen = ref(false);
const commentsCount = ref(props.post.commentsData?.length || 0);

const openModal = () => {
  isModalOpen.value = true;
};

const closeModal = () => {
  isModalOpen.value = false;
};

const updateCommentsCount = (newComments) => {
  commentsCount.value = newComments.length;
  props.post.commentsData = newComments;
  emit('update-comments', newComments);
};


const commentWord = computed(() => getCommentWord(commentsCount.value));

</script>

<template>
  <div class="bg-white rounded-lg overflow-hidden">
    <img :src="post.imageUrl" alt="" class="w-full object-cover" @click="openModal">
    <div class="py-10px">
      <p class="text-sm text-gray-500 flex gap-10px max-w-1100:gap-1">
        {{ post.date }}
        <span>•</span>
        <span class="flex items-center items-center gap-1">
          <svg width="14" height="14" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M8.04297 1.04199C6.6585 1.04199 5.30512 1.45253 4.15398 2.2217C3.00284 2.99087 2.10563 4.08412 1.57582 5.36321C1.046 6.64229 0.907378 8.04976 1.17747 9.40762C1.44757 10.7655 2.11426 12.0128 3.09322 12.9917C4.07219 13.9707 5.31947 14.6374 6.67734 14.9075C8.0352 15.1776 9.44267 15.039 10.7218 14.5091C12.0008 13.9793 13.0941 13.0821 13.8633 11.931C14.6324 10.7798 15.043 9.42646 15.043 8.04199C15.043 6.18548 14.3055 4.405 12.9927 3.09224C11.68 1.77949 9.89948 1.04199 8.04297 1.04199ZM8.04297 14.0652C6.84855 14.0652 5.68099 13.7109 4.68804 13.047C3.6951 12.3832 2.92143 11.4397 2.46494 10.3359C2.00846 9.23219 1.88968 8.01783 2.12365 6.84655C2.35762 5.67527 2.93381 4.59974 3.7793 3.75607C4.6248 2.9124 5.70157 2.33853 6.87335 2.10709C8.04513 1.87565 9.25924 1.99705 10.362 2.45592C11.4647 2.91479 12.4066 3.6905 13.0683 4.68487C13.73 5.67925 14.0818 6.84758 14.0792 8.04199C14.0775 9.64238 13.441 11.1767 12.3094 12.3084C11.1777 13.44 9.64336 14.0765 8.04297 14.0783V14.0652ZM11.2988 8.04199C11.2988 8.16979 11.248 8.29235 11.1576 8.38272C11.0673 8.47308 10.9447 8.52385 10.8169 8.52385H8.04297C7.91517 8.52385 7.79261 8.47308 7.70224 8.38272C7.61188 8.29235 7.56111 8.16979 7.56111 8.04199V4.08292C7.56111 3.95512 7.61188 3.83256 7.70224 3.74219C7.79261 3.65183 7.91517 3.60106 8.04297 3.60106C8.17077 3.60106 8.29333 3.65183 8.3837 3.74219C8.47406 3.83256 8.52483 3.95512 8.52483 4.08292V7.56013H10.8365C10.9608 7.56518 11.0784 7.61816 11.1646 7.70799C11.2508 7.79781 11.2979 7.91091 11.2988 8.04199Z"
              fill="#6B7280"></path>
          </svg>
          {{ post.timeToRead }}
        </span>
        <span>•</span>
        <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M13.45 12.7333V7.23333C13.4478 6.53782 13.1705 5.87141 12.6787 5.37961C12.1869 4.8878 11.5205 4.61053 10.825 4.60833H3.32501V3.9C3.32499 2.8766 3.72981 1.89475 4.45112 1.16876C5.17242 0.442775 6.15163 0.0316041 7.17501 0.0250015H14.0417C15.0694 0.0250015 16.055 0.433259 16.7817 1.15996C17.5084 1.88667 17.9167 2.87229 17.9167 3.9V8.9C17.9145 9.91909 17.511 10.8963 16.7936 11.62C16.0761 12.3438 15.1024 12.7557 14.0833 12.7667L13.45 12.7333ZM10.825 3.35833C11.8527 3.35833 12.8383 3.76659 13.565 4.4933C14.2918 5.22 14.7 6.20562 14.7 7.23333V11.4C15.2563 11.256 15.7499 10.9334 16.1051 10.4818C16.4604 10.0302 16.6577 9.47452 16.6667 8.9V3.9C16.6645 3.20448 16.3872 2.53808 15.8954 2.04627C15.4036 1.55447 14.7372 1.2772 14.0417 1.275H7.17501C6.57162 1.27426 5.98652 1.48208 5.51878 1.86325C5.05104 2.24443 4.72941 2.77555 4.60834 3.36667L10.825 3.35833ZM7.39168 17.975C7.11942 17.9763 6.85098 17.911 6.60983 17.7846C6.36868 17.6582 6.16217 17.4746 6.00834 17.25L5.25834 16.1917C5.23236 16.1517 5.19642 16.1191 5.15405 16.0972C5.11168 16.0753 5.06434 16.0648 5.01668 16.0667H4.00001C3.48764 16.0722 2.97927 15.976 2.50431 15.7837C2.02936 15.5915 1.59725 15.3069 1.233 14.9465C0.868744 14.5862 0.579582 14.1571 0.382245 13.6843C0.184908 13.2114 0.0833139 12.7041 0.0833435 12.1917V7.23333C0.0833139 6.72094 0.184908 6.21362 0.382245 5.74075C0.579582 5.26788 0.868744 4.83884 1.233 4.47846C1.59725 4.11808 2.02936 3.83352 2.50431 3.64126C2.97927 3.44899 3.48764 3.35283 4.00001 3.35833H10.8667C11.8944 3.35833 12.88 3.76659 13.6067 4.4933C14.3334 5.22 14.7417 6.20562 14.7417 7.23333V12.1917C14.7417 13.2194 14.3334 14.205 13.6067 14.9317C12.88 15.6584 11.8944 16.0667 10.8667 16.0667H9.76668C9.71914 16.0656 9.67209 16.0764 9.62986 16.0983C9.58762 16.1201 9.55157 16.1522 9.52501 16.1917L8.77501 17.25C8.62119 17.4746 8.41467 17.6582 8.17352 17.7846C7.93237 17.911 7.66393 17.9763 7.39168 17.975ZM4.00001 4.60833C3.6521 4.60393 3.30677 4.66851 2.98397 4.79835C2.66116 4.9282 2.36729 5.12072 2.11934 5.36481C1.87138 5.60889 1.67425 5.89969 1.53934 6.22041C1.40443 6.54113 1.33442 6.8854 1.33334 7.23333V12.1917C1.33108 12.5413 1.39869 12.8879 1.53222 13.2111C1.66574 13.5342 1.86249 13.8275 2.1109 14.0735C2.35931 14.3196 2.65438 14.5136 2.97878 14.6441C3.30319 14.7745 3.65039 14.8389 4.00001 14.8333H5.01668C5.26537 14.8321 5.51062 14.8914 5.7313 15.0061C5.95197 15.1208 6.14143 15.2874 6.28334 15.4917L7.02501 16.5C7.06634 16.559 7.12121 16.6071 7.18501 16.6405C7.24881 16.6738 7.31968 16.6914 7.39168 16.6917C7.46367 16.6914 7.53454 16.6738 7.59834 16.6405C7.66215 16.6071 7.71701 16.559 7.75834 16.5L8.50001 15.4417C8.64737 15.2466 8.83922 15.0897 9.05956 14.9839C9.2799 14.878 9.52234 14.8264 9.76668 14.8333H10.825C11.5212 14.8333 12.1889 14.5568 12.6812 14.0645C13.1734 13.5722 13.45 12.9045 13.45 12.2083V7.23333C13.4478 6.53782 13.1705 5.87141 12.6787 5.37961C12.1869 4.8878 11.5205 4.61053 10.825 4.60833H4.00001ZM4.48334 9C4.32841 9 4.17697 9.04594 4.04815 9.13202C3.91933 9.21809 3.81893 9.34043 3.75964 9.48357C3.70035 9.6267 3.68484 9.7842 3.71506 9.93616C3.74529 10.0881 3.81989 10.2277 3.92944 10.3372C4.03899 10.4468 4.17857 10.5214 4.33052 10.5516C4.48247 10.5818 4.63998 10.5663 4.78311 10.507C4.92625 10.4478 5.04859 10.3474 5.13466 10.2185C5.22074 10.0897 5.26668 9.93826 5.26668 9.78333C5.26451 9.57625 5.18128 9.37827 5.03485 9.23183C4.88841 9.0854 4.69042 9.00217 4.48334 9ZM7.40001 9C7.2466 8.99705 7.09571 9.03922 6.96606 9.12127C6.83641 9.20332 6.73371 9.32164 6.6707 9.46154C6.6077 9.60144 6.58717 9.75676 6.61166 9.90823C6.63615 10.0597 6.70459 10.2006 6.80847 10.3136C6.91235 10.4265 7.04711 10.5064 7.19601 10.5434C7.34492 10.5804 7.50141 10.5729 7.64607 10.5217C7.79073 10.4706 7.91718 10.3781 8.00973 10.2557C8.10228 10.1333 8.15685 9.98645 8.16668 9.83333C8.17228 9.72799 8.15677 9.62259 8.12106 9.52333C8.08535 9.42406 8.03016 9.33294 7.95874 9.25531C7.88731 9.17767 7.8011 9.11509 7.70515 9.07125C7.6092 9.02741 7.50545 9.00318 7.40001 9ZM10.3083 9C10.1534 9 10.002 9.04594 9.87315 9.13202C9.74433 9.21809 9.64393 9.34043 9.58464 9.48357C9.52535 9.6267 9.50984 9.7842 9.54006 9.93616C9.57029 10.0881 9.64489 10.2277 9.75444 10.3372C9.86399 10.4468 10.0036 10.5214 10.1555 10.5516C10.3075 10.5818 10.465 10.5663 10.6081 10.507C10.7512 10.4478 10.8736 10.3474 10.9597 10.2185C11.0457 10.0897 11.0917 9.93826 11.0917 9.78333C11.0895 9.57625 11.0063 9.37827 10.8598 9.23183C10.7134 9.0854 10.5154 9.00217 10.3083 9Z"
            fill="#7E8299" />
        </svg>

        {{ commentsCount }} {{ getCommentWord(commentsCount) }}

      </p>
      <p class="font-semibold text-lg cursor-pointer" @click="openModal">{{ post.title }}</p>
      <p class="text-sm text-gray-500 max-w-1100:text-sm">{{ post.description }}</p>
      <div class="flex gap-2 mt-3">
        <span v-for="tag in post.tags" :key="tag"
          class="text-blue-600 bg-blue-100 px-14px py-6px rounded-tag text-sm text-tag-text">
          {{ tag }}
        </span>
      </div>
    </div>
    <Modal v-if="isModalOpen" :post="post" @close="closeModal" @update-comments="updateCommentsCount" />
  </div>
</template>
